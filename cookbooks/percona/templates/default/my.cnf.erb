# Generated by Chef for <%= @node['hostname'] %> for Ubuntu 10.04
# Local modifications will be overwritten.

[client]
port   = 3306
socket = /var/run/mysqld/mysqld.sock

[mysqld_safe]
socket = /var/run/mysqld/mysqld.sock
nice   = 0

[mysqld]
skip-external-locking
skip-federated
skip-slave-start

back_log                = 50
basedir                 = /usr
<% if @node['mysql']['bind_address'] != false %>bind-address            = <%= @node['mysql']['bind_address'] || '0.0.0.0' %><% end %>
character_set_server    = utf8
collation_server        = utf8_general_ci
datadir                 = /var/lib/mysql
ft_min_word_len         = 3
key_buffer              = <%= @node['mysql']['key_buffer'] %>
lc-messages-dir         = /usr/share/mysql/english
log-error               = /var/log/mysql/mysqld.err
<% if @node['mysql']['slave'] == true %>max_allowed_packet      = 64M<% end %>
max_connections         = <%= @node['mysql']['max_connections'] %>
max_heap_table_size     = 256M # match with tmp_table_size
myisam-recover          = BACKUP
myisam_sort_buffer_size = 32M
net_buffer_length       = 64K
net_read_timeout        = 30
net_write_timeout       = 60
pid-file                = /var/run/mysqld/mysqld.pid
port                    = 3306
socket                  = /var/run/mysqld/mysqld.sock
sort_buffer_size        = 4M
sync-binlog             = 0
table_open_cache        = 800
thread_cache_size       = 8
thread_stack            = 192K
tmpdir                  = <%= @node['mysql']['tmpdir'] %>
tmp_table_size          = 256M # match with max_heap_table_size
user                    = mysql
wait_timeout            = <%= @node['mysql']['wait_timeout'] %>

query_cache_limit       = <%= @node['mysql']['query_cache_limit'] %>
query_cache_size        = <%= @node['mysql']['query_cache_size'] %>

# Performance monitoring settings
log-queries-not-using-indexes    = 0
<% if @node['mysql']['slave'] == true %>
slow_query_log          = 1
slow_query_log_file     = /var/log/mysql/mysql-slow.log
long_query_time         = 2
<% else %>
slow_query_log          = 0
<% end %>

# Replication/MMM Settings
server_id               = <%= @node['mysql']['server_id'] %>
log_bin                 = /var/lib/mysql/binlogs/mysql-bin.log
log_bin_index           = /var/lib/mysql/binlogs/mysql-bin.log.index
relay_log               = /var/lib/mysql/binlogs/mysql-relay-bin
relay_log_index         = /var/lib/mysql/binlogs/mysql-relay-bin.index
expire_logs_days        = 5
max_binlog_size         = 100M
log_slave_updates       = 1
<% if @node['mysql']['slave'] == true %>
read_only               = 1
report_host             = <%= @node['mysql']['master'] %>
report_port             = 3306
<% end %>

# InnoDB optimizations
innodb_file_per_table
innodb_buffer_pool_size = <%= @node['mysql']['innodb_buffer_pool_size'] %>
<% if @node['mysql']['innodb_log_file_size'] != false %>innodb_log_file_size            = <%= @node['mysql']['innodb_log_file_size'] %><% end %>
innodb_flush_method     = O_DIRECT
innodb_log_buffer_size  = <%= @node['mysql']['innodb_log_buffer_size'] %>

innodb_thread_concurrency       = 0
innodb_flush_log_at_trx_commit  = 2
innodb_additional_mem_pool_size = 100M

# Tried the following parameters to no good effect, actually (very) small decrease in performance, thus they are commented out but document here, just because.
#innodb_data_home_dir = /path/to/mysql
#innodb_data_file_path = ibdata1:10M:autoextend
#innodb_log_group_home_dir = /path/to/mysql
#transaction-isolation=READ-COMMITTED

[mysqldump]
quick
quote-names
max_allowed_packet = 16M

[mysql]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8
no-auto-rehash # faster start of mysql but no tab completion

[isamchk]
key_buffer = 16M

[mysqladmin]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8

[mysqlcheck]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8

[mysqldump]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8

[mysqlimport]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8

[mysqlshow]
character-sets-dir = /usr/share/mysql/charsets
default-character-set = utf8

[myisamchk]
character-sets-dir = /usr/share/mysql/charsets

[myisampack]
character-sets-dir = /usr/share/mysql/charsets

!includedir /etc/mysql/conf.d/
